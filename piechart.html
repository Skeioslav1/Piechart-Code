<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(drawChart);

      function getQueryParam(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      function drawChart() {
        try {
          var jsonData = getQueryParam("data");
          if (!jsonData) throw "No data found in URL.";

          var parsedData = JSON.parse(decodeURIComponent(jsonData));

          var data = [["Plan", "Count"]];
          parsedData.forEach((item) => {
            data.push([item.Plan, item.Count]);
          });

          var dataTable = google.visualization.arrayToDataTable(data);

          var options = {
            chartArea: { width: "90%", height: "90%" }, // Optimized for 500px chart
            pieHole: 0, // Full pie chart
            pieSliceText: "label", // Show the plan name (GOLD, SILVER, etc.)
            pieSliceTextStyle: {
              fontSize: 14, // Set text size to 14px
              bold: true
            },
            slices: {}, // This will be updated dynamically for better contrast
            tooltip: { text: "percentage" }, // Show percentage in tooltip
            legend: "none", // Remove legend
          };

          // Customize slice colors for better contrast
          var colors = ["#ff5733", "#33ff57", "#3357ff", "#ff33a8", "#f4c542"];
          parsedData.forEach((item, index) => {
            options.slices[index] = { textStyle: { fontSize: 14, color: "#fff" } }; // White text inside slices
          });

          var chart = new google.visualization.PieChart(document.getElementById("piechart"));
          chart.draw(dataTable, options);
        } catch (error) {
          console.error("Error processing chart data:", error);
        }
      }
    </script>
  </head>
  <body>
    <div id="piechart" style="width: 500px; height: 500px;"></div>
  </body>
</html>
